<!DOCTYPE html>
<!-- saved from url=(0061)file:///D:/Etty%20Golan/Downloads/digit_span_final%20(2).html -->
<html lang="he" dir="rtl"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <title>מטלת Digit Span</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg1: #eef3ff;
      --bg2: #e8f0ff;
      --ink: #0f2544;
      --accent: #0b8b94;
      --accent-soft: #bae6ec;
      --card: #ffffff;
      --danger: #d9534f;
      --muted: #6b7280;
      --shadow: 0 20px 50px rgba(9, 25, 66, 0.12);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Heebo","Segoe UI",system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      color: var(--ink);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px 12px;
    }

    .wrap { width: 100%; max-width: 720px; }

    .card {
      background: var(--card);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding: 24px 22px 20px;
      position: relative;
      overflow: hidden;
    }

    .badge {
      display: inline-block;
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 13px;
      margin-bottom: 4px;
    }

    h1 {
      margin: 4px 0 8px;
      font-size: 22px;
    }

    .subtitle {
      margin: 0 0 16px;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.6;
    }

    .section-title {
      margin: 16px 0 6px;
      font-weight: 700;
      font-size: 16px;
    }

    .highlight { font-weight: 700; color: var(--accent); }
    .highlight-strong {
      font-weight: 900;
      color: var(--accent);
      font-size: 17px;
      text-decoration: underline;
    }

    .content p { margin: 6px 0 8px; }

    .digits-display {
      margin: 26px auto 14px;
      min-height: 56px;
      font-size: 40px;
      letter-spacing: 12px;
      text-align: center;
      font-weight: 700;
    }

    .digits-display span {
      display: inline-block;
      min-width: 24px;
    }

    .response-area {
      margin-top: 6px;
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: center;
    }

    .response-area input {
      flex: 1;
      max-width: 220px;
      padding: 8px 10px;
      font-size: 22px;
      text-align: center;
      border-radius: 10px;
      border: 1px solid #cbd5e1;
      outline: none;
      direction: ltr;
    }

    .response-area input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(11, 139, 148, 0.15);
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 8px 18px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.06s ease, box-shadow 0.06s ease, background 0.15s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--accent);
      color: #ffffff;
      box-shadow: 0 10px 30px rgba(11, 139, 148, 0.4);
    }

    .btn-primary:hover:not(:disabled) {
      background: #0a7581;
      transform: translateY(-1px);
      box-shadow: 0 14px 36px rgba(11, 139, 148, 0.5);
    }

    .btn-primary:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 8px 22px rgba(11, 139, 148, 0.35);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }

    .btn-secondary:hover:not(:disabled) {
      background: #d1d5db;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .footer-text {
      margin-top: 16px;
      font-size: 13px;
      color: var(--muted);
      text-align: center;
    }

    .phase-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 13px;
      background: #eff6ff;
      color: #1d4ed8;
      margin-top: 2px;
    }

    .phase-tag span { font-weight: 700; }

    .hidden { display: none !important; }

    @media (max-width: 480px) {
      .card { padding: 20px 16px 16px; }
      h1 { font-size: 20px; }
      .digits-display {
        font-size: 32px;
        letter-spacing: 8px;
      }
    }
  </style>
</head>
<body dir="rtl">
  <div class="wrap">
    <div class="card">
      <div id="badge" class="badge">מטלת זיכרון ספרות</div>
      <h1 id="title">הוראות למטלה</h1>
      <p id="subtitle" class="subtitle">בכל שלב תופיע לפניך סדרת ספרות. לאחר ההצגה תתבקש/י להקליד אותן בהתאם להוראות.</p>

      <div id="phaseTag" class="phase-tag">
        מצב נוכחי: <span id="phaseLabel">הסבר כללי + תרגול קצר</span>
      </div>

      <div id="contentArea" class="content">
        <p>
          במטלה זו יוצגו בפניך ספרות <span class="highlight">אחת אחרי השנייה</span> על גבי המסך.
          לאחר שהספרות ייעלמו, תתבקש/י להקליד אותן בשורת ההקלדה וללחוץ על
          <span class="highlight">"אישור"</span>.
        </p>
        <p>
          תחילה תתקיים <span class="highlight">דוגמת תרגול קצרה</span> (שאינה נכללת בציון),
          ולאחר מכן יתחיל <span class="highlight-strong">החלק הראשון – קדימה</span>:
          עלייך להקליד את הספרות <span class="highlight">באותו סדר שבו הופיעו</span>.
        </p>
        <p>
          בהמשך, לאחר סיום החלק קדימה, יופיע הסבר נוסף ויתקיים תרגול קצר לחלק
          <span class="highlight-strong">"אחורה"</span>, שבו תתבקש/י להקליד את הספרות
          <span class="highlight">בסדר הפוך</span> (מהסוף להתחלה).
        </p>
      </div>

      <div id="digitsArea" class="digits-display"></div>

      <div id="responseArea" class="response-area hidden">
        <input id="responseInput" type="text" inputmode="numeric" autocomplete="off" placeholder="הקלד/י כאן את הספרות">
        <button id="submitBtn" class="btn btn-primary">אישור</button>
      </div>

      <div id="buttonsArea" style="margin-top:18px; display:flex; justify-content:center; gap:8px;">
        <button id="continueBtn" class="btn btn-primary">התחל/י תרגול קדימה</button>
      </div>

      <div id="footer" class="footer-text">אם משהו לא ברור, אפשר להבין דרך התרגול – הוא אינו נכלל בציון.</div>
    </div>
  </div>

  <script>
    /**********************
     * פרמטרים מה-URL (לא חובה)
     **********************/
    const query = new URLSearchParams(location.search || "");
    const REDIRECT = query.get("redirect") || null;
    const PID = query.get("pid") || null;

    /**********************
     * פרמטרים של המטלה
     **********************/
    const TRIALS_PER_SPAN = 2;

    const forwardConfig = {
      minSpan: 2,
      maxSpan: 9
    };

    const backwardConfig = {
      minSpan: 2,
      maxSpan: 8
    };

    /**********************
     * אלמנטים מה-DOM
     **********************/
    const titleEl = document.getElementById("title");
    const subtitleEl = document.getElementById("subtitle");
    const badgeEl = document.getElementById("badge");
    const contentArea = document.getElementById("contentArea");
    const digitsArea = document.getElementById("digitsArea");
    const responseArea = document.getElementById("responseArea");
    const responseInput = document.getElementById("responseInput");
    const submitBtn = document.getElementById("submitBtn");
    const continueBtn = document.getElementById("continueBtn");
    const footerEl = document.getElementById("footer");
    const phaseTag = document.getElementById("phaseTag");
    const phaseLabel = document.getElementById("phaseLabel");

    /**********************
     * משתני מצב
     **********************/
    let phase = "intro-forward";   // intro-forward, practice-forward, task-forward, break, intro-backward, practice-backward, task-backward, end
    let direction = "forward";     // "forward" או "backward"
    let currentSpan = 2;
    let trialInSpan = 0;           // 0,1
    let errorsInSpan = 0;
    let correctInSpan = 0;
    let isShowingDigits = false;
    let currentSequence = [];
    let currentSubmitHandler = null;

    let totalForwardTrials = 0;
    let totalForwardErrors = 0;
    let totalBackwardTrials = 0;
    let totalBackwardErrors = 0;

    /**********************
     * פונקציות עזר
     **********************/
    function setPhaseTag(text) {
      if (!text) {
        phaseTag.classList.add("hidden");
        return;
      }
      phaseTag.classList.remove("hidden");
      phaseLabel.textContent = text;
    }

    function makeRandomSequence(len) {
      const seq = [];
      for (let i = 0; i < len; i++) {
        const d = Math.floor(Math.random() * 10);
        seq.push(d.toString());
      }
      return seq;
    }

    function normalizeAnswer(str) {
      return (str || "").trim().replace(/\s+/g, "").replace(/[^0-9]/g, "");
    }

    function getCorrectString(seq, dir) {
      if (dir === "forward") return seq.join("");
      return seq.slice().reverse().join("");
    }

    function resetSpanCounters() {
      trialInSpan = 0;
      errorsInSpan = 0;
      correctInSpan = 0;
    }

    function disableButtons() {
      continueBtn.disabled = true;
      submitBtn.disabled = true;
    }

    function enableButtons() {
      continueBtn.disabled = false;
      submitBtn.disabled = false;
    }

    function showDigits(seq) {
      isShowingDigits = true;
      digitsArea.textContent = "";
      responseArea.classList.add("hidden");
      responseInput.value = "";
      responseInput.disabled = true;
      submitBtn.disabled = true;

      let index = 0;
      const interval = 1000;

      function showNext() {
        if (index >= seq.length) {
          setTimeout(() => {
            digitsArea.textContent = "";
            isShowingDigits = false;
            responseArea.classList.remove("hidden");
            responseInput.disabled = false;
            submitBtn.disabled = false;
            responseInput.focus();
          }, 400);
          return;
        }
        digitsArea.innerHTML = "<span>" + seq[index] + "</span>";
        index++;
        setTimeout(showNext, interval);
      }

      showNext();
    }

    function setSubmitHandler(fn) {
      currentSubmitHandler = fn;
    }

    submitBtn.addEventListener("click", () => {
      if (currentSubmitHandler) currentSubmitHandler();
    });

    responseInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && currentSubmitHandler) {
        e.preventDefault();
        currentSubmitHandler();
      }
    });

    /**********************
     * מסכי טקסט
     **********************/
    function renderIntroForward() {
      phase = "intro-forward";
      direction = "forward";

      setPhaseTag("הסבר כללי + תרגול קצר");
      badgeEl.textContent = "מטלת זיכרון ספרות";
      titleEl.textContent = "הוראות למטלה";
      subtitleEl.textContent =
        "בכל שלב תופיע לפניך סדרת ספרות. לאחר ההצגה תתבקש/י להקליד אותן בהתאם להוראות.";
      contentArea.innerHTML = `
        <p>
          במטלה זו יוצגו בפניך ספרות <span class="highlight">אחת אחרי השנייה</span> על גבי המסך.
          לאחר שהספרות ייעלמו, תתבקש/י להקליד אותן בשורת ההקלדה וללחוץ על
          <span class="highlight">"אישור"</span>.
        </p>
        <p>
          תחילה תתקיים <span class="highlight">דוגמת תרגול קצרה</span> (שאינה נכללת בציון),
          ולאחר מכן יתחיל <span class="highlight-strong">החלק הראשון – קדימה</span>:
          עלייך להקליד את הספרות <span class="highlight">באותו סדר שבו הופיעו</span>.
        </p>
        <p>
          בהמשך, לאחר סיום החלק קדימה, יופיע הסבר נוסף ויתקיים תרגול קצר לחלק
          <span class="highlight-strong">"אחורה"</span>, שבו תתבקש/י להקליד את הספרות
          <span class="highlight">בסדר הפוך</span> (מהסוף להתחלה).
        </p>
      `;
      digitsArea.textContent = "";
      responseArea.classList.add("hidden");
      footerEl.textContent = "אם משהו לא ברור, אפשר להבין דרך התרגול – הוא אינו נכלל בציון.";
      continueBtn.classList.remove("hidden");
      continueBtn.textContent = "התחל/י תרגול קדימה";
      continueBtn.onclick = startForwardPractice;
      setSubmitHandler(null);
    }

    function renderIntroBackward() {
      phase = "intro-backward";
      direction = "backward";

      setPhaseTag("הסבר לחלק אחורה + תרגול");
      badgeEl.textContent = "חלק ב׳ – ספרות אחורה";
      titleEl.textContent = "הוראות לחלק אחורה";
      subtitleEl.innerHTML = "<span class='highlight-strong'>בחלק זה יש לשנות את כיוון ההקלדה.</span>";
      contentArea.innerHTML = `
        <p>
          בחלק זה שוב יוצגו בפניך ספרות בזו אחר זו, אך כעת עלייך לזכור אותן
          <span class="highlight">ולהקליד אותן בסדר הפוך</span> לסדר שבו הופיעו.
        </p>
        <p>
          לדוגמה: אם הופיעו הספרות <span class="highlight">3-7-1</span>,
          עלייך להקליד <span class="highlight">1-7-3</span>.
        </p>
        <p>
          מיד יופיע <span class="highlight">ניסיון תרגול קצר</span> (שאינו נכלל בציון),
          ולאחר מכן תתחיל המשימה הרשמית בחלק "אחורה".
        </p>
      `;
      digitsArea.textContent = "";
      responseArea.classList.add("hidden");
      footerEl.textContent = "הדגש כאן הוא על הכיוון: תמיד מהספרה האחרונה לראשונה.";
      continueBtn.classList.remove("hidden");
      continueBtn.textContent = "התחל/י תרגול אחורה";
      continueBtn.onclick = startBackwardPractice;
      setSubmitHandler(null);
    }

    function renderBreakScreen() {
      phase = "break";
      setPhaseTag("הפסקה קצרה");
      badgeEl.textContent = "סיום חלק קדימה";
      titleEl.textContent = "סיום חלק קדימה";
      subtitleEl.textContent = "";
      contentArea.innerHTML = `
        <p>
          סיימת את <span class="highlight">החלק הראשון – קדימה</span>.
        </p>
        <p>
          כעת תתקיים הפסקה קצרה, ולאחר מכן נמשיך ל
          <span class="highlight-strong">חלק השני – אחורה</span>, שבו יש להקליד את הספרות בסדר הפוך.
        </p>
      `;
      digitsArea.textContent = "";
      responseArea.classList.add("hidden");
      footerEl.textContent = "כשאת/ה מוכן/ה, לחצ/י על \"המשך\" כדי לעבור להסבר על חלק אחורה.";
      continueBtn.classList.remove("hidden");
      continueBtn.textContent = "המשך לחלק אחורה";
      continueBtn.onclick = renderIntroBackward;
      setSubmitHandler(null);
    }

    function renderEndScreen() {
      phase = "end";
      setPhaseTag("המטלה הסתיימה");
      badgeEl.textContent = "תודה רבה";
      titleEl.textContent = "סיום המטלה";
      subtitleEl.textContent = "";
      contentArea.innerHTML = `
        <p>סיימת את שני חלקי מטלת ה-Digit Span – קדימה ואחורה.</p>
        <p>תודה רבה על ההשתתפות!</p>
      `;
      digitsArea.textContent = "";
      responseArea.classList.add("hidden");
      footerEl.textContent = "";

      continueBtn.classList.add("hidden");
      setSubmitHandler(null);

      // הודעה ל-Qualtrics (אם רלוונטי)
      try {
        window.parent.postMessage({
          type: "digitspan_finished",
          pid: PID,
          summary: {
            forwardTrials: totalForwardTrials,
            forwardErrors: totalForwardErrors,
            backwardTrials: totalBackwardTrials,
            backwardErrors: totalBackwardErrors
          }
        }, "*");
      } catch(e){}

      // הפניה אוטומטית אם הועבר redirect
      if (REDIRECT) {
        try { window.location.href = REDIRECT; } catch(e){}
      }
    }

    /**********************
     * תרגולי דוגמה
     **********************/
    function startForwardPractice() {
      phase = "practice-forward";
      direction = "forward";
      setPhaseTag("תרגול – קדימה");
      badgeEl.textContent = "תרגול קדימה";
      titleEl.textContent = "תרגול קצר – קדימה";
      subtitleEl.textContent = "";
      contentArea.innerHTML = `
        <p>
          בתרגול זה תופיע סדרת ספרות אחת באורך שתי ספרות.
          לאחר שהספרות ייעלמו, הקלד/י אותן
          <span class="highlight">באותו סדר</span> שבו הופיעו ולחצ/י על "אישור".
        </p>
      `;
      footerEl.textContent = "תרגול זה אינו נכלל בציון – מטרתו לוודא שההוראה ברורה.";
      responseArea.classList.add("hidden");
      continueBtn.classList.remove("hidden");
      continueBtn.textContent = "התחל/י את התרגול";
      continueBtn.onclick = () => runPracticeTrial("forward");
      setSubmitHandler(null);
    }

    function startBackwardPractice() {
      phase = "practice-backward";
      direction = "backward";
      setPhaseTag("תרגול – אחורה");
      badgeEl.textContent = "תרגול אחורה";
      titleEl.textContent = "תרגול קצר – אחורה";
      subtitleEl.textContent = "";
      contentArea.innerHTML = `
        <p>
          בתרגול זה תופיע סדרת ספרות אחת באורך שתי ספרות.
          לאחר שהספרות ייעלמו, עלייך להקליד אותן
          <span class="highlight">בסדר הפוך</span> – מהספרה האחרונה לראשונה.
        </p>
        <p>
          לדוגמה: אם הופיעו הספרות <span class="highlight">4-9</span>, יש להקליד <span class="highlight">9-4</span>.
        </p>
      `;
      footerEl.textContent = "גם תרגול זה אינו נכלל בציון – הוא רק לווידוא הבנת הכיוון.";
      responseArea.classList.add("hidden");
      continueBtn.classList.remove("hidden");
      continueBtn.textContent = "התחל/י את התרגול";
      continueBtn.onclick = () => runPracticeTrial("backward");
      setSubmitHandler(null);
    }

    function runPracticeTrial(dir) {
      direction = dir;
      digitsArea.textContent = "";
      responseArea.classList.add("hidden");
      continueBtn.classList.add("hidden");
      footerEl.textContent = "שימי/ה לב לספרות שמופיעות כעת.";

      const seq = makeRandomSequence(2);
      currentSequence = seq;
      showDigits(seq);

      setSubmitHandler(() => {
        if (isShowingDigits) return;
        const ans = normalizeAnswer(responseInput.value);
        if (!ans) { responseInput.focus(); return; }
        responseArea.classList.add("hidden");
        digitsArea.textContent = "";
        setSubmitHandler(null);

        contentArea.innerHTML = `
          <p>תודה, התרגול הסתיים.</p>
          <p>
            כעת תתחיל המשימה האמיתית בחלק
            <span class="highlight-strong">"${dir === "forward" ? "קדימה" : "אחורה"}"</span>.
          </p>
        `;
        footerEl.textContent = "";
        continueBtn.classList.remove("hidden");
        continueBtn.textContent = dir === "forward" ? "התחל/י משימת קדימה" : "התחל/י משימת אחורה";
        continueBtn.onclick = dir === "forward" ? startForwardTask : startBackwardTask;
      });
    }

    /**********************
     * משימות אמיתיות
     **********************/
    function startForwardTask() {
      phase = "task-forward";
      direction = "forward";
      setPhaseTag("משימה – קדימה");
      badgeEl.textContent = "חלק א׳ – ספרות קדימה";
      titleEl.textContent = "משימת קדימה";
      subtitleEl.textContent = "הקלד/י בכל פעם את הספרות בסדר שבו הופיעו על המסך.";
      contentArea.innerHTML = `
        <p>
          כעת מתחילה המשימה בחלק <span class="highlight-strong">"קדימה"</span>.
          יוצגו סדרות ספרות באורכים הולכים וגדלים, החל מ-2 ספרות.
          בכל שלב עלייך להקליד את הספרות <span class="highlight">באותו סדר שבו הופיעו</span>.
        </p>
      `;
      footerEl.textContent = "אם אינך בטוח/ה – הקלד/י כמיטב יכולתך והמשך/י הלאה.";
      continueBtn.classList.add("hidden");
      responseArea.classList.add("hidden");
      submitBtn.classList.remove("hidden");

      currentSpan = forwardConfig.minSpan;
      resetSpanCounters();
      setSubmitHandler(handleTaskSubmit);
      scheduleNextTrial();
    }

    function startBackwardTask() {
      phase = "task-backward";
      direction = "backward";
      setPhaseTag("משימה – אחורה");
      badgeEl.textContent = "חלק ב׳ – ספרות אחורה";
      titleEl.textContent = "משימת אחורה";
      subtitleEl.innerHTML = "<span class='highlight-strong'>בחלק זה תמיד מקלידים מהסוף להתחלה.</span>";
      contentArea.innerHTML = `
        <p>
          כעת מתחילה המשימה בחלק <span class="highlight-strong">"אחורה"</span>.
          בכל שלב יוצגו בפניך ספרות, ולאחר מכן עלייך להקליד אותן
          <span class="highlight">בסדר הפוך</span> – מהספרה האחרונה לראשונה.
        </p>
      `;
      footerEl.textContent = "נסה/י לשים לב במיוחד לכיוון. גם אם אינך בטוח/ה – ענה/י כמיטב יכולתך.";
      continueBtn.classList.add("hidden");
      responseArea.classList.add("hidden");
      submitBtn.classList.remove("hidden");

      currentSpan = backwardConfig.minSpan;
      resetSpanCounters();
      setSubmitHandler(handleTaskSubmit);
      scheduleNextTrial();
    }

    function scheduleNextTrial() {
      responseInput.value = "";
      responseArea.classList.add("hidden");
      digitsArea.textContent = "";
      footerEl.textContent = "שימי/ה לב לספרות שמופיעות כעת.";

      const cfg = direction === "forward" ? forwardConfig : backwardConfig;
      if (currentSpan > cfg.maxSpan) {
        if (direction === "forward") renderBreakScreen();
        else renderEndScreen();
        return;
      }

      currentSequence = makeRandomSequence(currentSpan);
      showDigits(currentSequence);
    }

    function handleTaskSubmit() {
      if (isShowingDigits) return;

      const ans = normalizeAnswer(responseInput.value);
      if (!ans) { responseInput.focus(); return; }

      const correctStr = getCorrectString(currentSequence, direction);
      const isCorrect = ans === correctStr;

      if (direction === "forward") {
        totalForwardTrials++;
        if (!isCorrect) totalForwardErrors++;
      } else {
        totalBackwardTrials++;
        if (!isCorrect) totalBackwardErrors++;
      }

      if (isCorrect) correctInSpan++;
      else errorsInSpan++;

      const cfg = direction === "forward" ? forwardConfig : backwardConfig;

      // כלל עצירה: שתי טעויות באותו אורך
      if (errorsInSpan >= 2) {
        if (direction === "forward") renderBreakScreen();
        else renderEndScreen();
        return;
      }

      trialInSpan++;

      if (trialInSpan >= TRIALS_PER_SPAN) {
        const hadSuccess = correctInSpan > 0;
        if (hadSuccess && currentSpan < cfg.maxSpan) {
          currentSpan++;
          resetSpanCounters();
          scheduleNextTrial();
        } else {
          if (direction === "forward") renderBreakScreen();
          else renderEndScreen();
        }
      } else {
        scheduleNextTrial();
      }
    }

    /**********************
     * התחלה
     **********************/
    window.addEventListener("load", () => {
      renderIntroForward();
    });
  </script>


</body></html>